// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace theme_switcher.Shared
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using theme_switcher;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/_Imports.razor"
using theme_switcher.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/Shared/ThemeSwitcher.razor"
using Microsoft.AspNetCore.WebUtilities;

#line default
#line hidden
#nullable disable
    public partial class ThemeSwitcher : Microsoft.AspNetCore.Components.ComponentBase, IAsyncDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 27 "/Users/akorenchikov/Development/blazor-projects/theme-switcher/Shared/ThemeSwitcher.razor"
       
    static readonly Dictionary<string, string[]> GroupedThemes = new () {
        ["Color"] = new [] { "Default" },
        ["DevExpress"] = new [] {
            "Blazing Berry", "Purple", "Office White"
        },
        ["Bootswatch"] = new [] {
            "Flatly", "Cosmo"
        }    
    };
    
    bool themesVisible;
    string appliedTheme;
    [Parameter] public string Theme { get; set; }
    [Parameter] public RenderFragment<ToggleButtonContainerContext> ToggleButton { get; set; }
    [Parameter] public RenderFragment<ThemesSelectorContainerContext> ThemesSelectorContainer { get; set; } 
        =  (c) => b =>  {
            if(c.ThemesSelectorVisible)
                c.ThemesSelectorView(b);
        };
    [Parameter] public RenderFragment<AffectedAreaContext> StylesheetLinkContainer { get; set; }
    readonly JSModuleSource _jsModule = new JSModuleSource();
    protected override async Task OnAfterRenderAsync(bool firstRender) {
        if(firstRender)
            await _jsModule.Attach(JSRuntime);
    }
    string GetUrlWithSpecifiedTheme(string themeName) {
        var uri = new Uri(NavigationManager.Uri);
        var queryParts = QueryHelpers.ParseNullableQuery(uri.Query) ?? new ();
        queryParts[nameof(Theme)] = themeName;
        return QueryHelpers.AddQueryString(uri.LocalPath, queryParts);
    }
    protected override void OnInitialized() {
        NavigationManager.LocationChanged += OnLocationChanged;
        SyncThemeParameter();
        appliedTheme = Theme;
    }
    protected bool SyncThemeParameter() {
        Theme = QueryHelpers.ParseNullableQuery(new Uri(NavigationManager.Uri).Query)?.GetValueOrDefault(nameof(Theme)) ?? "default";
        return Theme != appliedTheme;
    }
    public  ValueTask DisposeAsync() {
        NavigationManager.LocationChanged -= OnLocationChanged;
        return _jsModule.DisposeAsync();
    }
    void OnLocationChanged(object sender, LocationChangedEventArgs args) {
        if(SyncThemeParameter()) {
            var theme = Theme ?? "default";
            InvokeAsync(async () => {
                await _jsModule.PrepareInstantLoadAsync($"/themes/{theme}/bootstrap.min.css");
                appliedTheme = theme;
                StateHasChanged();
            });
        }
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
    }
}
#pragma warning restore 1591
